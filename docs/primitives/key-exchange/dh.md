# DH

Building on the previous [generalization framework](/primitives/key-exchange/#generalized-framework), the Diffie-Hellman key exchange uses:

$$\begin{equation}\begin{aligned}
f: \mathbb{Z} &\rightarrow \langle g \rangle \subset \mathbb{Z}_p^* \\
x &\rightarrow g^x \mod p
\end{aligned}\end{equation}$$

that is the cyclic group of integers modulo $p$ (a large prime), generated by $g$, under the multiplication modulo $p$.

## Protocol

1. Establish public parameters (often hardcoded in protocol standards)
   - pick a large prime $p$
   - another prime $g$ (generator) such that $1 \lt g \lt p -1$.

2. Pick a random secret $a$ (private key) and compute $A \equiv g^a \mod p$.
3. Pick a random secret $b$ (private key) and compute $B \equiv g^b \mod p$.
4. Each party sends $A$ and $B$ to the other party.
5. Each party computes $A^b \mod p$ and $B^a \mod p$ and compares them to the received values.
6. If they match, the key exchange is successful.

Indeed they will match because:
$$\begin{align}
\text{Z is commutative under multiplication} &\implies ab = ba \\
&\implies g^{ab} = g^{ba} \\
&\implies (g^a)^b = (g^{b})^a  \\
&\implies A^b = B^a
\end{align}$$

## Security

!> The security of the Diffie-Hellman key exchange depends on $f$ being one way, which holds under the [discrete logarithm assumption](https://en.wikipedia.org/wiki/Discrete_logarithm)/[CDH assumption](https://en.wikipedia.org/wiki/Computational_Diffie%E2%80%93Hellman_assumption).

!> DH is not post-quantum secure (because the CDH is not.)

!> **Large prime**\
In "modern" cryptography, this means at least 2048 bits long (2048-bit RSA key, TLS 1.2...) to offer 128 bits of security.

!> Public keys need to be validated ($p^{order} = identity$) in order to protect against [small subgroup attacks](https://crypto.stackexchange.com/questions/111121/small-subgroup-attack-when-using-a-schnorr-group-for-dhke).

!> In modern implementations, for improved security, a large prime factor $q$ is chosen such that $q$ divides $p-1$, and a subgroup of order $q$ within $\mathbb{Z}_p^*$ is used.
This helps mitigates some [attacks](https://en.wikipedia.org/wiki/Pohlig%E2%80%93Hellman_algorithm), where the discrete logarithm assumption is broken (can be efficiently computed) if $p-1$ has only small factors.

## Limitations/Caveats

!> Diffie-Hellman is an **unauthenticated** key exchange.
